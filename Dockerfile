# 1. Базовый образ — официальный легковесный nginx на alpine
FROM nginx:alpine

# 2. Устанавливаем необходимые зависимости (в данном случае не требуется,
#    но можно обновить индекс пакетов или установить дополнительные утилиты)
#    Например, установим curl для проверки (опционально)
RUN apk add --no-cache curl

# 3. Создаём рабочую директорию, куда будем копировать сайт
WORKDIR /var/www/demo

# 4. Копируем файлы приложения
COPY index.html /var/www/demo/index.html
# Копируем конфигурацию nginx в директорию conf.d, 
# чтобы она автоматически подключилась к основному конфигу
COPY nginx.conf /etc/nginx/conf.d/demo.conf

# 5. Указываем порт, который слушает наше приложение (согласно nginx.conf)
EXPOSE 8181

# Добавляем healthcheck для мониторинга контейнера
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
CMD wget --no-verbose --tries=1 --spider http://localhost:8181/ || exit 1

# Команда запуска по умолчанию уже задана в базовом образе:
# CMD ["nginx", "-g", "daemon off;"]
# При желании можно переопределить, но в данном случае она подходит.
